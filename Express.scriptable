{
  "always_run_in_app" : false,
  "icon" : {
    "color" : "red",
    "glyph" : "magic"
  },
  "name" : "Express",
  "script" : "\/\/ ====== å‰ç½®å‡†å¤‡ ======\nlet fm = FileManager.iCloud();\nlet imgPath = fm.joinPath(fm.documentsDirectory(), \"kuaidi.png\");\nlet dataPath = fm.joinPath(fm.documentsDirectory(), \"kuaidi.json\");\n\nfunction pad(n) { return n < 10 ? \"0\" + n : n; }\nfunction color(light, dark) { return Color.dynamic(new Color(light), new Color(dark)); }\nfunction simplifyCompanyName(name) {\n  if (!name) return \"æœªçŸ¥å¿«é€’\";\n  return name.replace(\/^ã€|ã€‘$\/g, \"\").replace(\/å¿«é€’|ç‰©æµ\/g, \"\").replace(\/\\s+\/g, \"\") || \"æœªçŸ¥å¿«é€’\";\n}\nfunction createSeparatorImage(width) {\n  const ctx = new DrawContext();\n  ctx.size = new Size(width, 1);\n  ctx.setFillColor(color(\"#EEEEEE\", \"#333333\"));\n  ctx.fillRect(new Rect(0, 0, width, 1));\n  return ctx.getImage();\n}\nasync function ensureFile(path) {\n  if (fm.fileExists(path)) {\n    if (fm.isFileStoredIniCloud(path) && !fm.isFileDownloaded(path)) {\n      await fm.downloadFileFromiCloud(path);\n    }\n    return true;\n  }\n  return false;\n}\nfunction showErrorWidget(message) {\n  let w = new ListWidget();\n  w.backgroundColor = color(\"#FFFFFF\", \"#1C1C1E\");\n  w.cornerRadius = 16;\n  w.setPadding(12, 12, 12, 12);\n  let text = w.addText(message);\n  text.font = Font.systemFont(14);\n  text.textColor = Color.red();\n  text.centerAlignText();\n  Script.setWidget(w);\n  Script.complete();\n}\n\n\/\/ ====== æ•°æ®åŠ è½½ ======\nlet parcels = [];\nlet unpickedCount = 0; \/\/ ç»Ÿè®¡æœªå–ä»¶æ€»æ•°\n\nif (!(await ensureFile(dataPath))) {\n  showErrorWidget(\"ç¼ºå°‘ kuaidi.json æ–‡ä»¶ï¼Œè¯·å…ˆè¿è¡Œ ExpressData.js åˆ›å»ºæ–‡ä»¶ã€‚\");\n  return;\n}\ntry {\n  let rawData = fm.readString(dataPath);\n  if (!rawData) {\n    showErrorWidget(\"kuaidi.json æ–‡ä»¶å†…å®¹ä¸ºç©ºï¼Œè¯·æ£€æŸ¥æ–‡ä»¶ï¼\");\n    return;\n  }\n  let allParcels = JSON.parse(rawData) || [];\n\n  \/\/ æŒ‰æ—¶é—´ä»æ–°åˆ°æ—§æ’åº\n  allParcels.sort((a, b) => {\n    let ta = new Date(a.time).getTime();\n    let tb = new Date(b.time).getTime();\n    return tb - ta;\n  });\n\n  \/\/ ç»Ÿè®¡æ‰€æœ‰æœªå–ä»¶çš„æ•°é‡\n  unpickedCount = allParcels.filter(p => p.status !== \"å·²å–ä»¶\").length;\n\n  \/\/ å³ä¾§æ˜¾ç¤ºï¼šè·³è¿‡å·²å–ä»¶ï¼Œæœ€å¤š 5 æ¡\n  const maxShow = 5;\n  let display = [];\n  for (let i = 0; i < allParcels.length && display.length < maxShow; i++) {\n    if (allParcels[i].status !== \"å·²å–ä»¶\") {\n      display.push(allParcels[i]);\n    }\n  }\n  parcels = display;\n\n} catch (e) {\n  showErrorWidget(\"è§£æ kuaidi.json æ–‡ä»¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼ã€‚\");\n  return;\n}\n\n\/\/ ====== å›ºå®šå±•ç¤ºé€»è¾‘ ======\nconst maxShow = 5;\nlet displayParcels = parcels.slice(0, maxShow);\nlet fixedCount = maxShow;\n\n\/\/ ====== å¸ƒå±€å‚æ•° ======\nconst widgetWidth = 360;\nconst widgetHeight = 170;\nconst paddingLR = 12 * 2;\nconst spacingMain = 14;\nconst leftWidth = 120;\nconst rightWidth = widgetWidth - leftWidth - paddingLR - spacingMain;\nconst leftHeight = widgetHeight - 24;\nconst itemSpacing = 1;\nconst separatorHeight = 3;\nconst extraTopBottomPadding = 4;\nconst rightContentOffset = 4;\n\n\/\/ å•æ¡é«˜åº¦å›ºå®šæŒ‰ 5 æ¡æ¥ç®—\nconst totalSpacing = itemSpacing * (fixedCount - 1);\nconst totalSeparatorHeight = separatorHeight * (fixedCount - 1);\nconst usableHeight = leftHeight - totalSpacing - totalSeparatorHeight - extraTopBottomPadding * 2;\nconst singleHeight = Math.floor(usableHeight \/ fixedCount);\n\n\/\/ å›ºå®šå­—ä½“å¤§å°\nconst companyFontSize = singleHeight > 50 ? 14 : singleHeight > 40 ? 12 : 10;\nconst codeFontSize = companyFontSize - 1;\nconst addrFontSize = Math.max(codeFontSize - 1, 9);\n\n\/\/ ====== åˆ›å»ºç»„ä»¶ ======\nlet w = new ListWidget();\nw.backgroundColor = color(\"#FFFFFF\", \"#1C1C1E\");\nw.cornerRadius = 16;\nw.setPadding(12, 12, 12, 12);\nw.size = new Size(widgetWidth, widgetHeight);\n\n\/\/ ==== æ²¡æœ‰å¿«é€’æ—¶ï¼šåªæ˜¾ç¤ºæç¤º ====\nif (parcels.length === 0) {\n  let emptyStack = w.addStack();\n  emptyStack.layoutVertically();\n  emptyStack.size = new Size(widgetWidth - paddingLR, widgetHeight - 24);\n  emptyStack.centerAlignContent();\n  emptyStack.addSpacer();\n\n  \/\/ âœ… æ¨ªå‘å®¹å™¨ï¼Œä¿è¯æ°´å¹³å±…ä¸­\n  let row = emptyStack.addStack();\n  row.layoutHorizontally();\n  row.centerAlignContent();\n  row.addSpacer();\n\n  let emptyText = row.addText(\"æš‚æ—¶è¿˜æ²¡æœ‰å¿«é€’ä¿¡æ¯å‘¢\");\n  emptyText.font = Font.boldSystemFont(15);\n  emptyText.textColor = color(\"#999999\", \"#AAAAAA\");\n  emptyText.centerAlignText();\n\n  row.addSpacer();\n  emptyStack.addSpacer();\n\n  w.refreshAfterDate = new Date(Date.now() + 30 * 60 * 1000);\n  Script.setWidget(w);\n  Script.complete();\n  return; \/\/ âœ… æå‰ç»“æŸ\n}\n\n\/\/ ====== æœ‰å¿«é€’æ—¶ï¼šæ­£å¸¸å¸ƒå±€ ======\nlet mainStack = w.addStack();\nmainStack.layoutHorizontally();\nmainStack.topAlignContent();\nmainStack.spacing = spacingMain;\n\n\/\/ ====== å·¦ä¾§ ======\nlet leftStack = mainStack.addStack();\nleftStack.layoutVertically();\nleftStack.topAlignContent();\nleftStack.size = new Size(leftWidth, leftHeight);\n\nlet leftPaddingStack = leftStack.addStack();\nleftPaddingStack.layoutHorizontally();\nleftPaddingStack.size = new Size(leftWidth, leftHeight);\nleftPaddingStack.centerAlignContent();\nleftPaddingStack.addSpacer(8);\n\nlet leftContentStack = leftPaddingStack.addStack();\nleftContentStack.layoutVertically();\nleftContentStack.topAlignContent();\nleftContentStack.spacing = 8;\nleftContentStack.size = new Size(leftWidth - 16, leftHeight);\n\nlet titleRow = leftContentStack.addStack();\ntitleRow.layoutHorizontally();\ntitleRow.centerAlignContent();\ntitleRow.spacing = 5;\n\nif (await ensureFile(imgPath)) {\n  let image = fm.readImage(imgPath);\n  let icon = titleRow.addImage(image);\n  icon.imageSize = new Size(26, 26);\n} else {\n  let emoji = titleRow.addText(\"ğŸ“¦\");\n  emoji.font = Font.systemFont(26);\n}\n\nlet title = titleRow.addText(\"Express\");\ntitle.font = Font.boldSystemFont(15);\ntitle.textColor = color(\"#333333\", \"#FFFFFF\");\n\nlet subTitle = leftContentStack.addText(\"å·²åˆ°è¾¾\");\nsubTitle.font = Font.systemFont(13);\nsubTitle.textColor = color(\"#666666\", \"#CCCCCC\");\n\n\/\/ æ˜¾ç¤ºæ‰€æœ‰æœªå–ä»¶çš„æ•°é‡\nlet countText = leftContentStack.addText(`${unpickedCount} ä¸ª`);\ncountText.font = Font.boldSystemFont(22);\ncountText.textColor = color(\"#FF5722\", \"#FFB74D\");\n\nlet remindText = leftContentStack.addText(\"è¯·åŠæ—¶å–ä»¶ï¼\");\nremindText.font = Font.systemFont(11);\nremindText.textColor = color(\"#FF9800\", \"#FFB74D\");\n\nleftContentStack.addSpacer(2);\nlet now = new Date();\nlet timeText = leftContentStack.addText(\n  `ä¸Šæ¬¡æ›´æ–°ï¼š${pad(now.getMonth() + 1)}\/${pad(now.getDate())} ${pad(now.getHours())}:${pad(now.getMinutes())}`\n);\ntimeText.font = Font.systemFont(9);\ntimeText.textColor = color(\"#999999\", \"#AAAAAA\");\n\n\/\/ ====== ä¸­é—´ç«–çº¿ ======\nlet dividerStack = mainStack.addStack();\ndividerStack.size = new Size(0.5, leftHeight);\ndividerStack.backgroundColor = color(\"#EEEEEE\", \"#333333\");\n\n\/\/ ====== å³ä¾§ ======\nlet rightStack = mainStack.addStack();\nrightStack.layoutVertically();\nrightStack.topAlignContent();\nrightStack.spacing = itemSpacing;\nrightStack.size = new Size(rightWidth, leftHeight);\nrightStack.clip = true;\n\nrightStack.addSpacer(extraTopBottomPadding);\n\nfor (let i = 0; i < fixedCount; i++) {\n  if (i < displayParcels.length) {\n    let p = displayParcels[i];\n    if (!p.status) p.status = \"å¾…å–ä»¶\";\n\n    let parcelStack = rightStack.addStack();\n    parcelStack.layoutVertically();\n    parcelStack.spacing = 3;\n    parcelStack.size = new Size(rightWidth - rightContentOffset, singleHeight);\n    parcelStack.setPadding(0, rightContentOffset, 0, 0);\n\n    let topRow = parcelStack.addStack();\n    topRow.layoutHorizontally();\n\n    let leftTop = topRow.addStack();\n    leftTop.layoutHorizontally();\n    leftTop.spacing = 8;\n    leftTop.centerAlignContent();\n\n    let company = leftTop.addText(simplifyCompanyName(p.type || \"\"));\n    company.font = Font.boldSystemFont(companyFontSize);\n    company.textColor = color(\"#444444\", \"#FFFFFF\");\n    company.lineLimit = 1;\n    company.minimumScaleFactor = 0.7;\n\n    let displayCode = p.code ? `å–ä»¶ç : ${p.code}` : \"å–ä»¶ç : æ— \";\n    let code = leftTop.addText(displayCode);\n    code.font = Font.systemFont(codeFontSize);\n    code.textColor = color(\"#FF5722\", \"#FFB74D\");\n    code.lineLimit = 1;\n    code.minimumScaleFactor = 0.7;\n\n    topRow.addSpacer();\n\n    let statusColor = p.status === \"å·²å–ä»¶\" ? \"#4CAF50\" : \"#1976D2\";\n    let status = topRow.addText(p.status);\n    status.font = Font.boldSystemFont(codeFontSize);\n    status.textColor = color(statusColor, statusColor);\n    status.lineLimit = 1;\n    status.minimumScaleFactor = 0.7;\n\n    let bottomRow = parcelStack.addStack();\n    bottomRow.layoutHorizontally();\n\n    let addrColor = color(\"#666666\", \"#CCCCCC\");\n    let timeFont = Font.systemFont(9);\n    let timeColor = color(\"#999999\", \"#AAAAAA\");\n\n    if (p.address) {\n      const addrLength = p.address.length;\n      let fontSize = addrFontSize;\n      if (addrLength > 20 && addrLength <= 40) fontSize = addrFontSize - 1;\n      else if (addrLength > 40) fontSize = Math.max(addrFontSize - 2, 8);\n\n      let addr = bottomRow.addText(p.address);\n      addr.font = Font.systemFont(fontSize);\n      addr.textColor = addrColor;\n      addr.lineLimit = 2;\n      addr.minimumScaleFactor = 0.6;\n    } else {\n      bottomRow.addSpacer();\n    }\n\n    bottomRow.addSpacer();\n\n    if (p.time) {\n      let dateObj = new Date(p.time);\n      if (!isNaN(dateObj)) {\n        let hh = pad(dateObj.getHours());\n        let mm = pad(dateObj.getMinutes());\n        let timeText = bottomRow.addText(`æ—¶é—´ ${hh}:${mm}`);\n        timeText.font = timeFont;\n        timeText.textColor = timeColor;\n        timeText.lineLimit = 1;\n        timeText.minimumScaleFactor = 0.7;\n      }\n    }\n\n    let sepOuter = rightStack.addStack();\n    sepOuter.layoutHorizontally();\n    sepOuter.size = new Size(rightWidth, separatorHeight);\n    sepOuter.addSpacer(rightContentOffset);\n    let sep = sepOuter.addImage(createSeparatorImage(rightWidth - 2 * rightContentOffset));\n    sep.imageSize = new Size(rightWidth - 2 * rightContentOffset, 1);\n    sep.tintColor = color(\"#EEEEEE\", \"#333333\");\n    sepOuter.addSpacer(rightContentOffset);\n\n  } else {\n    let emptyRow = rightStack.addStack();\n    emptyRow.size = new Size(rightWidth - rightContentOffset, singleHeight);\n    emptyRow.addSpacer();\n  }\n}\n\nrightStack.addSpacer(extraTopBottomPadding);\n\n\/\/ ==== å®šæ—¶åˆ·æ–° ====\nw.refreshAfterDate = new Date(Date.now() + 30 * 60 * 1000);\n\nScript.setWidget(w);\nScript.complete();",
  "share_sheet_inputs" : [

  ]
}